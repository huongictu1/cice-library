CREATE FUNCTION [dbo].[GetActual]
(
    @Barcode NVARCHAR(50),
    @Month INT,
    @Year INT
)
RETURNS FLOAT
AS
BEGIN
    DECLARE @ActualInventory FLOAT;

    -- Use a single query to get the actual inventory
    SELECT TOP 1 @ActualInventory = ActualInventory
    FROM dbo.Inventory
    WHERE
        Barcode = @Barcode
        AND MONTH([Date]) = @Month
        AND YEAR([Date]) = @Year
    ORDER BY ID DESC;

    -- If no value is found, set to 0
    SET @ActualInventory = ISNULL(@ActualInventory, 0);

    RETURN @ActualInventory;
END

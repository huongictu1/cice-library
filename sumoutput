CREATE FUNCTION [dbo].[SumOutput]
(
    @Barcode NVARCHAR(50),
    @Month INT,
    @Year INT
)
RETURNS FLOAT
AS
BEGIN
    DECLARE @DATE_APPROVAL DATETIME = dbo.GetDateApproval(@Barcode, @Month, @Year);
    DECLARE @SumOutput FLOAT;

    -- Use a single query to calculate the sum of output quantity
    SELECT @SumOutput = ISNULL(SUM(cs.OutputQuantity), 0)
    FROM dbo.ChemicalStore cs
    WHERE 
        cs.Barcode = @Barcode 
        AND MONTH(cs.DateCurent) = @Month 
        AND YEAR(cs.DateCurent) = @Year;

    RETURN @SumOutput;
END


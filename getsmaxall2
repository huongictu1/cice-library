CREATE FUNCTION [dbo].[GetSmaxALL2]
(
    @Barcode NVARCHAR(50),
    @Month INT,
    @Year INT
)
RETURNS FLOAT
AS
BEGIN
    DECLARE @Values FLOAT;

    -- Use a single query with MAX to get the maximum STT
    SELECT @Values = ISNULL(MAX(STT), 0)
    FROM dbo.Inventory
    WHERE 
        Barcode = @Barcode
        AND MONTH([Date]) <= @Month
        AND YEAR([Date]) = @Year;

    RETURN @Values;
END
